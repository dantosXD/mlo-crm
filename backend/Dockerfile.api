FROM node:20-bookworm-slim

WORKDIR /app

COPY backend/package*.json ./
COPY backend/prisma ./prisma
RUN npm ci

COPY backend/ ./
RUN npx prisma generate && npm run build

ENV NODE_ENV=production
ENV PORT=3002

EXPOSE 3002

# Keep migrations automatic for first-time deploys.
CMD ["sh", "-lc", "npx prisma migrate deploy && node dist/bootstrap.js"]

